<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Drug interaction checker service to help ensure safe medication usage">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline';
        style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
        font-src 'self' https://cdn.jsdelivr.net;
        connect-src 'self' https://api.fda.gov https://api.openai.com https://api.anthropic.com https://api.perplexity.ai https://generativelanguage.googleapis.com;
        img-src 'self' data:;
        object-src 'none';
        frame-src 'none';
        frame-ancestors 'none';
        base-uri 'self';
        form-action 'self';
        upgrade-insecure-requests;
    ">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), payment=()">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" integrity="sha384-..." crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css?v=1.0">
    
    <!-- 인라인 CSS 테스트 -->
    <style>
        /* CSS 로딩 테스트 - 이 스타일이 보이면 CSS가 정상 로드됨 */
        body {
            background-color: #ffffff !important;
        }
        
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a !important;
            }
        }
    </style>
    
    <!-- 기본 파비콘 (라이트 모드용) -->
    <link rel="icon" type="image/png" href="../logo/dark.png">
    
    <!-- 다크 모드용 파비콘 -->
    <link rel="icon" type="image/png" href="../logo/white.png" media="(prefers-color-scheme: dark)">
    
    <title>فحص تفاعل الأدوية</title>
</head>
<body class="preload">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loadingText" style="margin-top: 1rem;">Processing...</p>
        </div>
    </div>

    <!-- Drug Detail Information Modal -->
    <div id="drugDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="drugDetailTitle"></h3>
                <button class="modal-close" onclick="closeDrugDetail()" aria-label="Close">×</button>
            </div>
            <div class="modal-body" id="drugDetailBody"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <h3 class="settings-title">
                    🤖 AI Analysis Settings
                </h3>
                <button class="modal-close" onclick="closeSettings()" aria-label="Close">×</button>
            </div>
            <div class="settings-body">
                <!-- AI Service Selection -->
                <div class="form-group">
                    <label for="aiProvider" class="form-label">🎯 AI Service to Use</label>
                    <select id="aiProvider" class="form-select">
                        <option value="free">🆓 Free AI Service (Default)</option>
                        <option value="openai">OpenAI (GPT-4o-mini)</option>
                        <option value="claude">Anthropic Claude</option>
                        <option value="perplexity">Perplexity AI</option>
                        <option value="gemini">Google Gemini</option>
                        <option value="auto">🎲 Auto Select (Available)</option>
                    </select>
                    <div class="form-help">
                        Free AI service is provided by default. For higher quality analysis, enter your personal API keys.
                    </div>
                </div>
                
                <!-- Free AI Service Information -->
                <div class="form-group ai-config" data-provider="free">
                    <div class="free-ai-info">
                        <h4>🆓 خدمة الذكاء الاصطناعي المجانية</h4>
                        <p>تستخدم هذه الخدمة واجهات برمجة التطبيقات المجانية التالية للذكاء الاصطناعي:</p>
                        <ul>
                            <li><strong>Hugging Face Inference API</strong> - نماذج مفتوحة المصدر</li>
                            <li><strong>Ollama API</strong> - نماذج التنفيذ المحلية</li>
                            <li><strong>Groq API</strong> - خدمة الاستدلال السريع</li>
                        </ul>
                        <div class="license-info">
                            <h5>📄 معلومات الترخيص</h5>
                            <p>يتم توفير خدمة الذكاء الاصطناعي المجانية بالشروط التالية:</p>
                            <ul>
                                <li>حد الاستخدام اليومي: 100 طلب</li>
                                <li>حد وقت الاستجابة: 30 ثانية</li>
                                <li>قيود الاستخدام التجاري</li>
                                <li>أمان البيانات: يتم تشفير بيانات الإدخال أثناء المعالجة</li>
                            </ul>
                        </div>
                    </div>
                </div>


                <div class="form-group ai-config" data-provider="openai">
                    <label for="openaiApiKey" class="form-label">
                        <span class="provider-icon" alt="OpenAI"> 
                        مفتاح API OpenAI
                    </label>
                    <input type="password" 
                           id="openaiApiKey" 
                           class="form-input" 
                           placeholder="sk-..."
                           aria-label="مفتاح API OpenAI">
                    <div class="form-help">
                        <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener" style="color: var(--primary);">
                            احصل على مفتاح API OpenAI من موقع OpenAI →
                        </a>
                    </div>
                </div>

                <!-- Claude Settings -->
                <div class="form-group ai-config" data-provider="claude">
                    <label for="claudeApiKey" class="form-label">
                        مفتاح API Anthropic Claude
                    </label>
                    <input type="password" 
                           id="claudeApiKey" 
                           class="form-input" 
                           placeholder="sk-ant-..."
                           aria-label="مفتاح API Claude">
                    <div class="form-help">
                        <a href="https://console.anthropic.com/" target="_blank" rel="noopener" style="color: var(--primary);">
                            احصل على مفتاح API Anthropic من وحدة التحكم Anthropic →
                        </a>
                    </div>
                </div>

                <!-- Perplexity Settings -->
                <div class="form-group ai-config" data-provider="perplexity">
                    <label for="perplexityApiKey" class="form-label">
                        مفتاح API Perplexity
                    </label>
                    <input type="password" 
                           id="perplexityApiKey" 
                           class="form-input" 
                           placeholder="pplx-..."
                           aria-label="مفتاح API Perplexity">
                    <div class="form-help">
                        <a href="https://www.perplexity.ai/settings/api" target="_blank" rel="noopener" style="color: var(--primary);">
                        </a>
                    </div>
                </div>

                <!-- Gemini Settings -->
                <div class="form-group ai-config" data-provider="gemini">
                    <label for="geminiApiKey" class="form-label">
                        مفتاح API Google Gemini
                    </label>
                    <input type="password" 
                           id="geminiApiKey" 
                           class="form-input" 
                           placeholder="AI..."
                           aria-label="مفتاح API Gemini">
                    <div class="form-help">
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener" style="color: var(--primary);">
                            احصل على مفتاح API Gemini من Google AI Studio →
                        </a>
                    </div>
                </div>

                <!-- Status Display -->
                <div class="api-status">
                    <h4>🔑 حالة مفتاح API</h4>
                    <div class="status-grid">
                        <div class="status-item" id="openai-status">
                            <span class="status-icon">⚪</span>
                            <span>OpenAI</span>
                        </div>
                        <div class="status-item" id="claude-status">
                            <span class="status-icon">⚪</span>
                            <span>Claude</span>
                        </div>
                        <div class="status-item" id="perplexity-status">
                            <span class="status-icon">⚪</span>
                            <span>Perplexity</span>
                        </div>
                        <div class="status-item" id="gemini-status">
                            <span class="status-icon">⚪</span>
                            <span>Gemini</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="settings-actions">
                <button class="btn btn-secondary" onclick="closeSettings()">إلغاء</button>
                <button class="btn btn-primary" onclick="saveSettings()">حفظ</button>
                <button class="btn btn-secondary" onclick="testAllAPIs()">🧪 اختبار API</button>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Send Feedback</h3>
                <button class="modal-close" onclick="closeFeedbackModal()" aria-label="Close">×</button>
            </div>
            <div class="modal-body">
                <form id="feedbackForm" class="feedback-form">
                    <div class="form-group">
                        <label for="feedbackName" class="form-label">Name</label>
                        <input type="text" 
                               id="feedbackName" 
                               class="form-input" 
                               placeholder="Enter your name"
                               required
                               aria-label="Name">
                    </div>
                    
                    <div class="form-group">
                        <label for="feedbackEmail" class="form-label">Email</label>
                        <input type="email" 
                               id="feedbackEmail" 
                               class="form-input" 
                               placeholder="Enter your email"
                               required
                               aria-label="Email">
                    </div>
                    
                    <div class="form-group">
                        <label for="feedbackSubject" class="form-label">Subject</label>
                        <input type="text" 
                               id="feedbackSubject" 
                               class="form-input" 
                               placeholder="Enter feedback subject"
                               required
                               aria-label="Subject">
                    </div>
                    
                    <div class="form-group">
                        <label for="feedbackMessage" class="form-label">Message</label>
                        <textarea id="feedbackMessage" 
                                  class="form-textarea" 
                                  placeholder="Enter your feedback"
                                  rows="5"
                                  required
                                  aria-label="Message"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeFeedbackModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Send</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header scroll-fade">
            <h1>فحص تفاعل الأدوية</h1>
            <p>فحص التفاعل بين<br>الأدوية للاستخدام الآمن</p>
        </header>

        <!-- Drug Search Section -->
        <section class="card scroll-hidden scroll-delay-1">
            <h2 class="sr-only">Drug Search</h2>
            <div class="search-box">
                <input type="text" 
                       id="drugSearch" 
                       class="input-field" 
                       placeholder="Search for a drug (e.g. Aspirin, Aspirin)"
                       autocomplete="off"
                       aria-label="البحث عن الأدوية">

            </div>
            
            <div id="searchResults" class="search-results scroll-fade">
                <div id="searchResultsContent" class="search-results-content"></div>
            </div>
            
            <div class="recent-searches" style="margin-top: 1rem;">
                <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">عمليات البحث الأخيرة</div>
                <div id="recentSearchesList" style="display: flex; flex-wrap: wrap; gap: 0.5rem;"></div>
            </div>
        </section>


        <!-- Drug Selection Section -->
        <section class="card scroll-hidden scroll-delay-3">
            <h2 class="sr-only">Drug Selection</h2>
            <div class="drug-select-section">
                <div class="drug-select-container">
                    <div class="input-wrapper">
                        <input type="text" 
                               id="drug1" 
                               class="input-field" 
                               placeholder="الدواء الأول"
                               autocomplete="off"
                               aria-label="First Drug">
                    </div>
                </div>
                
                <div class="drug-select-container">
                    <div class="input-wrapper">
                        <input type="text" 
                               id="drug2" 
                               class="input-field" 
                               placeholder="الدواء الثاني"
                               autocomplete="off"
                               aria-label="Second Drug">
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary btn-block" onclick="checkInteraction()">
                التحقق من التفاعل
            </button>
        </section>
        
        <!-- 페이지 상단에 고정된 드러그 검색 결과 -->
        <div id="drug1List" class="drug-list">
            <div class="drug-items"></div>
        </div>
        <div id="drug2List" class="drug-list">
            <div class="drug-items"></div>
        </div>

        <!-- Result Section -->
        <section id="resultSection" class="result-section scroll-scale">
            <div id="result"></div>
        </section>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="scrollToTop()" title="Scroll to Top" aria-label="Scroll to Top">
        ↑
    </button>

    <!-- Settings Button -->
    <button class="settings-fab" title="AI Settings" aria-label="AI Settings">
        ⚙️
    </button>

    <!-- Notify Message -->
    <span id="alertMessage" class="alert" role="alert"></span>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <!-- Medical Disclaimer -->
            <div class="footer-disclaimer">
                <div class="disclaimer-content">
                    <h4>⚠️ إخلاء مسؤولية طبية مهم</h4>
                    <p>
                        هذه الأداة لأغراض تعليمية وإعلامية فقط. وهي ليست بديلاً عن المشورة الطبية أو التشخيص أو العلاج.
                        استشر دائمًا أخصائي رعاية صحية مؤهل قبل اتخاذ أي قرارات بشأن الأدوية أو العلاجات الطبية.
                        يمكن أن تكون التفاعلات الدوائية معقدة وفردية.
                    </p>
                </div>
            </div>

            <!-- Main Footer Content -->
            <div class="footer-content">
                <!-- About Section -->
                <div class="footer-section footer-about" style="padding-top: 2rem;">
                    <p>أداة شاملة للتحقق من التفاعلات الدوائية للمساعدة في ضمان الاستخدام الآمن للأدوية. استشر دائمًا متخصصي الرعاية الصحية للحصول على المشورة الطبية.</p>
                    <div class="footer-badges">
                        <span class="badge">قاعدة بيانات FDA</span>
                        <span class="badge">مدعوم بالذكاء الاصطناعي</span>
                        <span class="badge">أداة مجانية</span>
                    </div>
                </div>

                <!-- Similar Sites -->
                <div class="footer-section footer-links">
                    <h4>مواقع مشابهة</h4>
                    <div class="medical-links">
                        <a href="https://biolabs.world" target="_blank" rel="noopener">biolabs.world</a>
                    </div>
                </div>

                <!-- Medical Resources -->
                <div class="footer-section footer-resources">
                    <h4>الموارد الطبية</h4>
                    <div class="medical-links">
                        <a href="https://www.fda.gov" target="_blank" rel="noopener">FDA Official</a>
                        <a href="https://www.drugs.com/drug_interactions.php" target="_blank" rel="noopener">Drugs.com</a>
                        <a href="https://www.webmd.com" target="_blank" rel="noopener">WebMD</a>
                        <a href="https://medlineplus.gov" target="_blank" rel="noopener">MedlinePlus</a>
                    </div>
                </div>

                <!-- Contact & Social -->
                <div class="footer-section footer-contact">
                    <h4>اتصل بنا</h4>
                    <style>
                        h4 {
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            align-items: center;
                            text-align: center;
                            font-size: 1rem;
                            font-weight: 600;
                            margin-bottom: 0.2rem;
                        }
                        a {
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            align-items: center;
                            text-align: center;
                            font-size: 0.8rem;
                            color: var(--text-secondary);
                        }
                    </style>
                    <div class="social-links">
                        <a href="mailto:pistolinkr@icloud.com" title="Email">
                            <span>Email</span>
                        </a>
                        <a href="https://github.com/pistolinkr" target="_blank" rel="noopener" title="GitHub">
                            <span>GitHub</span>
                        </a>
                        <button class="feedback-btn" onclick="openFeedbackModal()" title="Send Feedback">
                            <span>Feedback</span>
        
                    </div>
                        </div>
                        </div>

            <!-- Footer Divider -->
            <div class="footer-divider"></div>

            <!-- Bottom Bar -->
            <div class="footer-bottom">
                <div class="footer-bottom-content">
                    <div class="footer-version-language">
                        <div class="footer-version">
                            <span>Beta v4.8 | G.gear® Pistol™</span>
                        </div>
                        <div class="footer-language">
                            <span class="current-language">🇸🇦 العربية</span>
                        </div>
                    </div>
                    <div class="footer-legal">
                        <a href="#" onclick="showPrivacyPolicy()">سياسة الخصوصية</a>
                        <a href="#" onclick="showTermsOfService()">شروط الخدمة</a>
                        <a href="#" onclick="showDataSources()">مصادر البيانات</a>
                            </div>
                    <div class="footer-copyright">
                        <p>&copy; 2025 Pistolinkr. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="../i18n.js"></script>
    <script src="config.js"></script>
    <script src="scripts.js"></script>
</body>
</html> 